<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>&lt; hydra &gt;</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="HYDRA">
  <meta property="og:description" content="live coding networked visuals in the browser">
  <meta property="og:image" content="/images/hydra-landing.png">
  <meta property="og:url" content="https://hydra.ojack.xyz">
  <meta name="twitter:title" content="HYDRA">
 <meta name="twitter:description" content="live coding networked visuals in the browser">
 <meta name="twitter:image" content="/images/hydra-landing.png">
 <meta name="twitter:card" content="summary_large_image">
 <script src="https://cdn.jsdelivr.net/npm/hydra-synth/dist/hydra-synth.js"></script>

 <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js" defer></script>
 <!-- <script src="./bundle.js?1.2wsdajk" defer></script>  -->
 <script>
   // Tauri local file helpers
   window.localFile = function(path) {
     if (window.__TAURI__ && window.__TAURI__.core && window.__TAURI__.core.convertFileSrc) {
       return window.__TAURI__.core.convertFileSrc(path);
     }
     return path;
   };

   // Convenience wrapper for loading local video
   window.loadVideo = function(source, path) {
     const url = window.localFile(path);
     source.initVideo(url);
     return source;
   };

   // Convenience wrapper for loading local image
   window.loadImage = function(source, path) {
     const url = window.localFile(path);
     source.initImage(url);
     return source;
   };

   // File picker dialog (if available)
   window.pickFile = async function(options = {}) {
     if (window.__TAURI__ && window.__TAURI__.dialog) {
       try {
         const selected = await window.__TAURI__.dialog.open({
           multiple: false,
           filters: options.filters || [
             { name: 'Media', extensions: ['mp4', 'webm', 'mov', 'avi', 'jpg', 'jpeg', 'png', 'gif'] }
           ]
         });
         if (selected) {
           return window.localFile(selected);
         }
       } catch (err) {
         console.error('File picker error:', err);
       }
     }
     return null;
   };

    // Audio input device selector
    window.selectAudioInput = async function() {
      try {
        // Get list of audio input devices
        const devices = await navigator.mediaDevices.enumerateDevices();
        const audioInputs = devices.filter(device => device.kind === 'audioinput');
        
        if (audioInputs.length === 0) {
          alert('No audio input devices found');
          return null;
        }

        // Create modal dialog
        const modal = document.createElement('div');
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.8);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 10000;
        `;

        const dialog = document.createElement('div');
        dialog.style.cssText = `
          background: #222;
          padding: 30px;
          border-radius: 8px;
          min-width: 400px;
          color: #fff;
          font-family: monospace;
        `;

        const title = document.createElement('h3');
        title.textContent = 'Select Audio Input Device';
        title.style.cssText = 'margin-top: 0; margin-bottom: 20px;';

        const select = document.createElement('select');
        select.style.cssText = `
          width: 100%;
          padding: 10px;
          margin-bottom: 20px;
          font-size: 14px;
          background: #333;
          color: #fff;
          border: 1px solid #555;
          border-radius: 4px;
        `;

        // Populate select with devices
        audioInputs.forEach((device, index) => {
          const option = document.createElement('option');
          option.value = device.deviceId;
          option.textContent = device.label || `Microphone ${index + 1}`;
          select.appendChild(option);
        });

        const buttonContainer = document.createElement('div');
        buttonContainer.style.cssText = 'display: flex; gap: 10px; justify-content: flex-end;';

        const okButton = document.createElement('button');
        okButton.textContent = 'OK';
        okButton.style.cssText = `
          padding: 10px 20px;
          background: #4CAF50;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
        `;

        const cancelButton = document.createElement('button');
        cancelButton.textContent = 'Cancel';
        cancelButton.style.cssText = `
          padding: 10px 20px;
          background: #666;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
        `;

        buttonContainer.appendChild(cancelButton);
        buttonContainer.appendChild(okButton);

        dialog.appendChild(title);
        dialog.appendChild(select);
        dialog.appendChild(buttonContainer);
        modal.appendChild(dialog);
        document.body.appendChild(modal);

        // Return promise that resolves with selected device
        return new Promise((resolve) => {
          okButton.onclick = () => {
            const selectedDevice = audioInputs.find(d => d.deviceId === select.value);
            document.body.removeChild(modal);
            console.log('Selected audio input:', selectedDevice.label || selectedDevice.deviceId);
            resolve(selectedDevice);
          };

          cancelButton.onclick = () => {
            document.body.removeChild(modal);
            resolve(null);
          };

          // ESC to cancel
          const escHandler = (e) => {
            if (e.key === 'Escape') {
              document.body.removeChild(modal);
              document.removeEventListener('keydown', escHandler);
              resolve(null);
            }
          };
          document.addEventListener('keydown', escHandler);
        });

      } catch (err) {
        console.error('Error selecting audio input:', err);
        alert('Error accessing audio devices. Please grant microphone permission.');
        return null;
      }
    };

    // Initialize audio with selected device
    window.initAudioWithDevice = async function(source) {
      const device = await window.selectAudioInput();
      if (device && source) {
        // Re-initialize audio with specific device
        try {
          const constraints = {
            audio: { deviceId: { exact: device.deviceId } },
            video: false
          };
          source.initAudio(constraints);
          console.log('Audio initialized with device:', device.label || device.deviceId);
        } catch (err) {
          console.error('Error initializing audio with device:', err);
        }
      }
      return device;
    };

    console.log('Tauri helpers loaded: localFile(), loadVideo(source, path), loadImage(source, path), pickFile()');
    console.log('Audio helpers loaded: selectAudioInput(), initAudioWithDevice(source)');
  </script>
  <script>
    // Fullscreen toggle using Tauri API
    window.toggleFullscreen = async function() {
      if (window.__TAURI__ && window.__TAURI__.window) {
        try {
          const appWindow = window.__TAURI__.window.getCurrentWindow();
          const isFullscreen = await appWindow.isFullscreen();
          await appWindow.setFullscreen(!isFullscreen);
          console.log('Fullscreen toggled:', !isFullscreen);
        } catch (err) {
          console.error('Error toggling fullscreen:', err);
        }
      } else {
        console.error('Tauri API not available');
      }
    };

    // Keyboard shortcut: F11 for fullscreen
    document.addEventListener('keydown', function(e) {
      if (e.key === 'F11') {
        e.preventDefault();
        window.toggleFullscreen();
      }
    });

    console.log('Fullscreen: Press F11 or call toggleFullscreen()');
  </script>
 <script src="./index.js" defer type="module"></script> 
 <link href="https://fonts.googleapis.com/css?family=Chivo:300,400,700" rel="stylesheet"> 
<link rel="stylesheet" href="/css/fontawesome.css">
  <link rel="stylesheet" href="/css/codemirror.css">
  <link rel="stylesheet" href="/css/tomorrow-night-eighties.css">
  <link rel="stylesheet" href="/css/show-hint.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/modal.css">
  <link rel="shortcut icon" type="image/png" href="https://cdn.glitch.com/597fe374-3d18-46a5-b99c-ceff1f8ffd79%2Ffavicon.png?1530891352785" /> 

</head>
<body>
</body>

</html>
